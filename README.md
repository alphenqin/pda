# 阀门仓储 PDA 系统

## 项目简介

本系统是为中石油下属企业"成都石油天然气大流量站"开发的阀门仓储管理PDA应用。系统主要用于对阀门厂家送检的样品阀门进行检测管理，通过PDA终端配合WMS系统和AGV调度系统，完成阀门的入库、送检、回库、出库等全流程操作。

### 系统架构

- **WMS系统**：管理库位、托盘、置换区、检测车间等信息
- **AGV调度系统**：调度室内/室外AGV完成托盘搬运
- **PDA终端**：一线操作终端，完成阀门入库、送检、回库、出库及任务管理

## 功能特性

### 1. 入库模块
- 托盘扫码：扫描托盘条码，自动识别托盘编号、型号、置换区站点和库位号
- 阀门绑定：录入阀门信息（厂家名称、阀门编号、阀门型号、入库日期）并绑定到托盘
- 呼叫入库：创建入库任务，调度AGV完成入库流程

### 2. 送检模块
- 选阀门：根据厂家、阀门编号、型号等条件查询并选择待送检阀门
- 呼叫送检：创建送检任务，调度AGV将阀门从库位运送到检测区站点
- 空托回库：阀门卸下后，将空托盘送回原库位

### 3. 回库模块
- 选阀门：选择检测完成待回库的阀门
- 呼叫托盘：调度AGV将空托盘从库位运送到检测区站点
- 阀门回库：将检测完成的阀门重新入库到原库位

### 4. 出库模块
- 选阀门：选择合格待出库的阀门
- 呼叫出库：创建出库任务，调度AGV将阀门从库位运送到库前置换区
- 空托回库：阀门卸下装车后，将空托盘送回库位

### 5. 任务管理模块
- 任务查询：按日期范围查询任务列表
- 任务详情：查看任务编号、类型、状态、创建时间等信息
- 取消任务：取消状态为"待执行"的任务

## 技术栈

- **开发语言**：Java
- **开发平台**：Android
- **最低SDK版本**：Android 7.0 (API 8)
- **目标SDK版本**：Android 6.0 (API 23)
- **编译SDK版本**：API 23
- **Java版本**：Java 8
- **依赖库**：
  - Android Support Library (RecyclerView, AppCompat)

## 项目结构

```
QS5502DEMO/
├── app/
│   ├── src/
│   │   └── main/
│   │       ├── java/com/qs/qs5502demo/
│   │       │   ├── MainActivity.java              # 主界面
│   │       │   ├── api/                           # API接口层
│   │       │   │   ├── ApiService.java            # API接口定义
│   │       │   │   └── ApiClient.java             # API客户端实现
│   │       │   ├── model/                         # 数据模型
│   │       │   │   ├── Pallet.java                # 托盘模型
│   │       │   │   ├── Valve.java                 # 阀门模型
│   │       │   │   └── Task.java                  # 任务模型
│   │       │   ├── util/                          # 工具类
│   │       │   │   ├── ScanHelper.java            # 扫码工具
│   │       │   │   └── DateUtil.java              # 日期工具
│   │       │   ├── inbound/                       # 入库模块
│   │       │   │   ├── InboundActivity.java
│   │       │   │   └── BindValveActivity.java
│   │       │   ├── send/                          # 送检模块
│   │       │   │   ├── SendInspectionActivity.java
│   │       │   │   └── SelectValveActivity.java
│   │       │   ├── returnwarehouse/                # 回库模块
│   │       │   │   └── ReturnWarehouseActivity.java
│   │       │   ├── outbound/                      # 出库模块
│   │       │   │   └── OutboundActivity.java
│   │       │   └── task/                          # 任务管理模块
│   │       │       └── TaskManageActivity.java
│   │       ├── res/                                # 资源文件
│   │       │   ├── layout/                        # 布局文件
│   │       │   └── values/                        # 字符串、样式等
│   │       └── AndroidManifest.xml                 # 应用清单
│   └── build.gradle                                # 构建配置
├── build.gradle                                    # 项目构建配置
└── README.md                                       # 项目说明文档
```

## 安装和运行

### 环境要求

- Android Studio（推荐最新版本）
- JDK 8 或更高版本
- Android SDK（API 23）
- Gradle 构建工具

### 编译步骤

1. **克隆项目**
   ```bash
   git clone [项目地址]
   cd QS5502DEMO
   ```

2. **打开项目**
   - 使用Android Studio打开项目目录
   - 等待Gradle同步完成

3. **配置网络请求**
   - 编辑 `app/src/main/java/com/qs/qs5502demo/api/ApiClient.java`
   - 修改 `BASE_URL` 为实际的WMS服务器地址

4. **编译运行**
   - 连接Android PDA设备（QS5502系列）
   - 点击运行按钮或使用快捷键 `Shift+F10`
   - 选择目标设备进行安装

### 打包发布

```bash
# 生成Release APK
./gradlew assembleRelease

# APK文件位置
app/build/outputs/apk/release/app-release.apk
```

## 使用说明

### 主界面

启动应用后进入主界面，包含5个功能入口：
- **入库**：进入入库操作流程
- **送检**：进入送检操作流程
- **回库**：进入回库操作流程
- **出库**：进入出库操作流程
- **任务管理**：查看和管理任务

### 入库流程

1. 点击"入库"按钮进入入库页面
2. 点击"1. 托盘扫码"，按PDA扫描键扫描托盘条码
3. 扫码成功后，系统自动显示托盘号和库位号
4. 点击"2. 阀门绑定"，录入阀门信息：
   - 入库日期（默认当天）
   - 厂家名称（必填）
   - 阀门编号（必填，唯一标识）
   - 阀门型号（必填）
5. 点击"绑定"按钮完成绑定
6. 点击"3. 呼叫入库"，确认后创建入库任务
7. 系统显示任务编号，任务创建成功

### 送检流程

1. 点击"送检"按钮进入送检页面
2. 点击"1. 选阀门"，进入选阀门页面
3. 输入查询条件（厂家名称、阀门编号、阀门型号、入库日期）
4. 点击"查询"按钮，选择目标阀门
5. 点击"确认"返回送检页面
6. 点击"2. 呼叫送检"，确认后创建送检任务
7. 阀门卸下后，点击"3. 1# 空托 回库"或"3. 2# 空托 回库"将空托盘送回库位

### 回库流程

1. 点击"回库"按钮进入回库页面
2. 点击"1. 选阀门"，选择检测完成待回库的阀门
3. 点击"2. 呼叫托盘"，将空托盘从库位运送到检测区站点
4. 工人将阀门放到托盘后，点击"3. 1# 阀门 回库"或"3. 2# 阀门 回库"
5. 系统创建回库任务，将阀门送回原库位

### 出库流程

1. 点击"出库"按钮进入出库页面
2. 点击"1. 选阀门"，选择合格待出库的阀门
3. 点击"2. 呼叫出库"，确认后创建出库任务
4. 工人卸下阀门装车后，点击"3. 1# 空托 回库"或"3. 2# 空托 回库"将空托盘送回库位

### 任务管理

1. 点击"任务管理"按钮进入任务管理页面
2. 输入起始日期和结束日期（可选，默认查询当天）
3. 点击"查询"按钮查询任务列表
4. 点击任务项选中任务
5. 对于状态为"待执行"的任务，可以点击"取消任务"进行取消

## API接口说明

### 接口定义

所有API接口定义在 `ApiService.java` 中，实际实现位于 `ApiClient.java`。

**注意**：当前 `ApiClient` 为模拟实现，需要根据实际WMS服务器接口进行替换。

### 主要接口

1. **托盘扫码**
   - 接口：`scanPallet(String barcode)`
   - 功能：根据托盘条码获取托盘信息

2. **阀门绑定**
   - 接口：`bindValve(Valve valve)`
   - 功能：绑定阀门信息到托盘

3. **查询阀门**
   - 接口：`queryValves(Map<String, String> params)`
   - 功能：根据条件查询阀门列表

4. **创建任务**
   - 接口：`createTask(String taskType, String palletNo, String locationCode, ...)`
   - 功能：创建AGV任务（入库/送检/回库/出库）

5. **查询任务**
   - 接口：`queryTasks(String startDate, String endDate)`
   - 功能：查询任务列表

6. **取消任务**
   - 接口：`cancelTask(String taskNo)`
   - 功能：取消指定任务

### 任务编号规则

- **入库任务**：`R` + 日期时间（精确到毫秒），例如：`R20250715145830999`
- **送检任务**：`S` + 日期时间（精确到毫秒）
- **回库任务**：`H` + 日期时间（精确到毫秒）
- **出库任务**：`C` + 日期时间（精确到毫秒）

## 扫码功能

系统使用QS5502 PDA设备自带的扫码功能，通过广播机制实现：

- **触发扫码**：发送广播 `hbyapi.intent.key_scan_down`
- **接收结果**：监听广播 `com.qs.scancode`，获取扫描数据

扫码功能已封装在 `ScanHelper` 工具类中，各模块可直接调用。

## 开发说明

### 代码规范

- 使用Java 8语法（但避免使用lambda表达式以确保兼容性）
- 遵循Android开发规范
- 所有Activity使用竖屏模式
- 按钮和文字使用较大字号，适合PDA操作

### 数据模型

- **Pallet**：托盘信息（托盘号、托盘型号、置换区站点、库位号）
- **Valve**：阀门信息（阀门编号、阀门型号、厂家名称、入库日期等）
- **Task**：任务信息（任务编号、任务类型、状态、创建时间等）

### 状态标识

- **灰色**：初始状态或未完成操作
- **绿色**：操作成功完成

### 网络请求

当前使用模拟实现，实际部署时需要：
1. 配置真实的WMS服务器地址
2. 实现真实的HTTP请求（可使用Retrofit、OkHttp或HttpURLConnection）
3. 处理网络异常和超时
4. 添加请求日志和错误处理

## 注意事项

1. **设备要求**
   - 适用于QS5502系列Android PDA设备
   - 需要设备支持扫码功能
   - 建议使用竖屏模式

2. **网络配置**
   - 确保PDA设备能够访问WMS服务器
   - 配置正确的服务器地址和端口
   - 检查网络权限配置

3. **数据安全**
   - 重要操作需要确认对话框
   - 任务创建后显示任务编号
   - 建议添加操作日志记录

4. **异常处理**
   - 网络异常时显示错误提示
   - 扫码失败时提示用户重新扫码
   - 表单验证失败时提示具体错误信息

5. **性能优化**
   - 网络请求在后台线程执行
   - UI更新在主线程进行
   - 避免阻塞主线程

## 更新日志

### v1.0.0 (2025-01-15)
- 初始版本发布
- 实现入库、送检、回库、出库功能
- 实现任务管理功能
- 集成QS5502扫码功能

## 联系方式

如有问题或建议，请联系开发团队。

## 许可证

本项目为内部使用项目，版权归中石油下属企业所有。

